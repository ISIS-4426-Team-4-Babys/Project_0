-- Create users table to store application users
CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password TEXT NOT NULL,
    profile_image TEXT NOT NULL
);

-- Create categories table for task grouping
CREATE TABLE categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT NOT NULL,
    id_user BIGINT NOT NULL,
    -- Foreign key to user with cascade delete
    CONSTRAINT category_id_user_fkey FOREIGN KEY (id_user) REFERENCES users(id) ON DELETE CASCADE
);

-- Create tasks table with status and foreign keys to categories and users
CREATE TABLE tasks (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text TEXT NOT NULL,
    creation_date DATE NOT NULL,
    end_date DATE NOT NULL,
    status VARCHAR(20) NOT NULL CHECK (status IN ('Sin Empezar', 'Empezada', 'Finalizada')),
    id_category BIGINT NOT NULL,
    id_user BIGINT NOT NULL,
    -- Foreign key to categories with cascade delete
    CONSTRAINT task_id_category_fkey FOREIGN KEY (id_category) REFERENCES categories(id) ON DELETE CASCADE,
    -- Foreign key to users with cascade delete
    CONSTRAINT task_id_user_fkey FOREIGN KEY (id_user) REFERENCES users(id) ON DELETE CASCADE
);

---------------------------------------------------
-- INSERT DATA (order matters: users -> categories -> tasks)
---------------------------------------------------

-- Users
INSERT INTO users (id, username, password, profile_image) VALUES
(1, 'NepoBaby', '$2a$10$xJW24YxXuNWIwwAHT91Dh.VXoAsztRPF7OMd31QLexH1.TAmUbIjC',
 'https://www.lego.com/cdn/cs/set/assets/blt5106608431ab56b9/02_Emmet_top_Hero_w_block.jpg?fit=crop&format=jpg&quality=80&width=800&height=426&dpr=1'),
(2, 'ErizoPetizo', '$2a$10$pFI5a39pewwrG.0ZAhqiuOSuio7PBNS50v/dZRdVkplfuUtegDX5W',
 'https://static01.nyt.com/images/2019/02/01/arts/01tvcol-legomovie/01tvcol-legomovie-articleLarge.jpg?quality=75&auto=webp&disable=upscale');

-- Categories
INSERT INTO categories (id, name, description, id_user) VALUES
(1, 'Universidad', 'Tareas de la Universidad de los Andes para el semestre 2025-20', 1),
(2, 'Trabajo', 'Tareas para la pasantía en telecomunicaciones en ZTE', 1),
(3, 'Tesis', 'Tareas para la tesis en seguridad en redes IoT', 1),
(5, 'Universidad', 'Tareas Uniandes', 2),
(6, 'Doctorado', 'Tareas de esclavo académico', 2);

-- Tasks
INSERT INTO tasks (id, text, creation_date, end_date, status, id_category, id_user) VALUES
(2, 'Tarea 1 - Procesamiento de Lenguaje Natural', '2025-08-18', '2025-08-27', 'Sin Empezar', 1, 1),
(1, 'Proyecto 0 - Desarrollo de Soluciones Cloud', '2025-08-18', '2025-08-19', 'Finalizada', 1, 1),
(4, 'Solicitar Préstamo Nano Jetson', '2025-08-18', '2025-08-21', 'Empezada', 3, 1),
(3, 'Averiguar Protocolos GPON y FTTx', '2025-08-18', '2025-08-22', 'Empezada', 2, 1),
(7, 'Laboratorios Ciberseguridad', '2025-08-18', '2025-08-22', 'Finalizada', 5, 2),
(8, 'Estado del Arte - Sistema CMS', '2025-08-18', '2025-08-29', 'Empezada', 6, 2);
